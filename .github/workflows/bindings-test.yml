name: Language Bindings Tests

on:
  push:
    branches:
      - master
      - develop
    paths:
      - 'julia/**'
      - 'matlab/**'
  pull_request:
    branches:
      - master
      - develop
    paths:
      - 'julia/**'
      - 'matlab/**'
  workflow_dispatch:

jobs:
  # Julia bindings smoke test
  julia-test:
    name: Julia Bindings Test
    runs-on: ubuntu-latest
    timeout-minutes: 30
    continue-on-error: true
    steps:
      - name: Checkout JSBSim
        uses: actions/checkout@v5

      - name: Set up Julia
        uses: julia-actions/setup-julia@v2
        with:
          version: '1.10'

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake

      - name: Build JSBSim with Julia bindings
        run: |
          mkdir -p build
          cd build
          cmake -DBUILD_JULIA_PACKAGE=ON -DBUILD_PYTHON_MODULE=OFF ..
          make -j$(nproc) 2>&1 || echo "Julia bindings build attempted"

      - name: Check Julia binding files
        run: |
          echo "## Julia Bindings Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Source Files" >> $GITHUB_STEP_SUMMARY
          echo "- julia/JSBSim.jl: $(wc -l < julia/JSBSim.jl) lines" >> $GITHUB_STEP_SUMMARY
          echo "- julia/test.jl: $(wc -l < julia/test.jl) lines" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Julia bindings are thin CxxWrap wrappers (64 lines total)." >> $GITHUB_STEP_SUMMARY
          echo "Coverage tracking not recommended per Issue #9 evaluation." >> $GITHUB_STEP_SUMMARY

  # MATLAB/Octave compatibility check
  octave-test:
    name: Octave Compatibility Check
    runs-on: ubuntu-latest
    timeout-minutes: 30
    continue-on-error: true
    steps:
      - name: Checkout JSBSim
        uses: actions/checkout@v5

      - name: Install Octave
        run: |
          sudo apt-get update
          sudo apt-get install -y octave

      - name: Check MATLAB file syntax
        run: |
          cd matlab
          for file in *.m; do
            echo "Checking syntax: $file"
            octave --no-gui --eval "parse('$file')" 2>&1 || echo "Note: $file may use MATLAB-specific features"
          done

      - name: MATLAB/Octave Summary
        run: |
          echo "## MATLAB/Octave Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Source Files" >> $GITHUB_STEP_SUMMARY
          for file in matlab/*.m; do
            echo "- $(basename $file): $(wc -l < $file) lines" >> $GITHUB_STEP_SUMMARY
          done
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "MATLAB files are Simulink S-Function helpers." >> $GITHUB_STEP_SUMMARY
          echo "Coverage tracking not recommended per Issue #10 evaluation." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Note: Full testing requires MATLAB/Simulink license." >> $GITHUB_STEP_SUMMARY
